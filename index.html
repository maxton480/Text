<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bulk Webtoon AI Eraser</title>
<style>
body{margin:0;background:#0b0b0b;color:#fff;font-family:system-ui}
header{position:sticky;top:0;background:#000;padding:10px;display:flex;gap:8px}
button,input{padding:10px;border-radius:8px;border:none;font-size:14px}
button{background:#222;color:#fff}
#pages{max-width:480px;margin:auto}
.page{margin:0;position:relative}
canvas{width:100%;display:block;touch-action:none}
#tools{position:fixed;bottom:10px;left:50%;transform:translateX(-50%);background:#000;padding:8px;border-radius:12px;display:flex;gap:8px}
</style>
</head>
<body>
<header>
  <input type="file" id="upload" multiple accept="image/*">
  <button onclick="downloadZIP()">Download ZIP</button>
</header>

<div id="pages"></div>

<div id="tools">
  <label>Brush <input type="range" id="brush" min="5" max="60" value="25"></label>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script>
const pages=document.getElementById('pages');
let canvases=[];

upload.onchange=e=>{
  pages.innerHTML='';canvases=[];
  [...e.target.files].forEach((file,i)=>{
    const img=new Image();
    const c=document.createElement('canvas');
    const ctx=c.getContext('2d');
    img.onload=()=>{
      c.width=img.width;
      c.height=img.height;
      ctx.drawImage(img,0,0);
    };
    img.src=URL.createObjectURL(file);
    enableEraser(c,ctx);
    const wrap=document.createElement('div');wrap.className='page';wrap.appendChild(c);
    pages.appendChild(wrap);
    canvases.push({canvas:c,file:file});
  });
};

function enableEraser(c,ctx){
  let erase=false;
  c.onpointerdown=e=>{erase=true;};
  c.onpointerup=e=>{erase=false;ctx.globalCompositeOperation='source-over';};
  c.onpointermove=e=>{
    if(!erase) return;
    const r=c.getBoundingClientRect();
    const x=(e.clientX-r.left)*(c.width/r.width);
    const y=(e.clientY-r.top)*(c.height/r.height);
    ctx.globalCompositeOperation='destination-out';
    ctx.beginPath();
    ctx.arc(x,y,brush.value,0,Math.PI*2);
    ctx.fill();
  };
}

async function downloadZIP(){
  const zip=new JSZip();
  for(let i=0;i<canvases.length;i++){
    const c=canvases[i].canvas;
    const blob=await new Promise(r=>c.toBlob(r,canvases[i].file.type,1));
    zip.file(canvases[i].file.name,blob);
  }
  const content=await zip.generateAsync({type:'blob'});
  saveAs(content,'webtoon_cleaned.zip');
}
</script>
</body>
</html>
